from virusTotal import *
from asmFeatures import *
from hexFeatures import *
from peFeatures import *
from checkPeFiles import *
from acra_tools import *
from files import *
from csvs import *

def preprocessingData(malwareDirectory):
    # Hashing files to sha256
    filesToSha256(malwareDirectory)
    print("Hashing files Done!")
    # Remove files without Pe Header
    removeFilesNo32bits(malwareDirectory)
    print("Remove files without PE Header Done!")

def setupConfigurationFolders(malwareFolder="MalwareFolder/"):
    virusTotalFolder = "pathTo/../VirusTotal/" # only used to get label of the malware
    datasetDirectory = "pathTo/../VirusFiles/" # directory of the malware folders
    apiFile = "pathTo/../APIs.txt" # file of the Windows APIs functions
    malwareDirectory = datasetDirectory+malwareFolder # whole malware directory
    
    outputDirectory = "pathTo/../Output/" # output folder
    asmOutput = outputDirectory+"AsmOutput/" # output folder for asm files
    hexOutput = outputDirectory+"HexOutput/" # output folder for hex files
    peOutput  = outputDirectory+"PeOutput/" # output folder for pe files
    expOutput = outputDirectory+"ExpOutput/" # output folder for the experiments
    
    tempFolder = "pathTo/../Temp/" # Folder for temporal files used by the program
    asmFolder = tempFolder+"Asm/" # folder for asm temp files 
    hexFolder = tempFolder+"Hex/" # folder for hex temp files 
    filesWithoutPeHeader = tempFolder+"FilesWithoutPeHeader/" # folder to put files that do not have PE header
    
    return virusTotalFolder,datasetDirectory,apiFile,malwareFolder,malwareDirectory,outputDirectory, asmOutput,hexOutput,peOutput,expOutput,tempFolder,asmFolder,hexFolder,filesWithoutPeHeader

def convertFiles(malwareDirectory,asmFolder,hexFolder):
    # asm format
    convertBinaryFilesToAsm(malwareDirectory,asmFolder)
    # hex format
    convertBinaryFilesToByte(malwareDirectory,hexFolder)
    
def getStaticFeatures(malwareDirectory,apiFile,asmFolder,hexFolder,asmOutput,hexOutput,peOutput):
    # asm
    getAsmFeatures(apiFile,asmFolder,asmOutput)
    # hex
    getHexFeatures(hexFolder,hexOutput)
    # pe
    getPeFeatures(malwareDirectory,peOutput)

def createCsvStatic(outputDirectory,apiFile,asmOutput,hexOutput,peOutput):
    # asm
    createAsmCsv(asmOutput,apiFile,outputDirectory)
    # hex
    createHexCsv(hexOutput,outputDirectory)
    # pe
    createPeCsv(peOutput,outputDirectory)

    # merge 
    # mergeStatic(outputDirectory) # only when asm, hex, pe are done 

def createCsvExperiments(totalExperiments,expOutput,outputFolder, headerType):
    createExpCsv(totalExperiments,expOutput,outputFolder, headerType)



      
